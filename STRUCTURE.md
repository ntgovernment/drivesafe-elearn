# Project Structure

## Directory Layout

```
drivesafe-elearn/
├── .git/                  # Git repository
├── .gitignore            # Git ignore rules
├── README.md             # Project documentation
├── STRUCTURE.md          # This file
├── package.json          # NPM configuration with build/serve scripts
├── build.js              # Build script (copies src → dist)
│
├── src/                  # Source files (edit these)
│   ├── drivesafe.js      # Main module loader (9.5KB)
│   ├── drivesafe.css     # Scoped styles (1.6KB)
│   ├── demo.html         # Demo/usage example (513B)
│   └── sw.js             # Service worker for offline support (3.3KB)
│
├── dist/                 # Distribution files (generated by build)
│   ├── drivesafe.js
│   ├── drivesafe.css
│   ├── demo.html
│   └── sw.js
│
└── [legacy files]        # Original standalone files (kept for reference)
    ├── index.html
    ├── loader.js
    ├── jszip.min.js
    └── sw.js
```

## Key Changes

### 1. Source Organization
- All distributable files moved to `src/`
- Clean separation between source and distribution

### 2. JSZip from CDN
- No longer bundled in JavaScript
- Loaded via CDN in demo.html: `https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js`
- Reduces bundle size significantly

### 3. Scoped CSS
- All styles prefixed with `.drivesafe-*`
- Prevents conflicts when embedded in other pages
- Classes: `.drivesafe-wrapper`, `.drivesafe-container`, etc.

### 4. Build System
- `npm run build` - Copies src/ to dist/
- `npm run dev` - Development server (port 8080)
- `npm run serve` - Production server (dist folder only)

## NPM Scripts

```json
{
  "build": "node build.js",           // Build dist from src
  "serve": "npx http-server dist -p 8080 -o",  // Serve dist/
  "dev": "npx http-server . -p 8080 -o"        // Serve all (dev mode)
}
```

## Files Explained

### src/drivesafe.js
- Auto-initializes on DOMContentLoaded
- Checks for JSZip availability
- Generates module selector interface
- Handles ZIP extraction and caching
- Service worker registration (optional via data-service-worker attribute)

### src/drivesafe.css
- Scoped styles for module interface
- Loading overlay with spinner
- Module grid layouts
- Responsive images
- All classes prefixed with `.drivesafe-*`

### src/demo.html
- Minimal usage example
- Includes JSZip from CDN
- Shows how to integrate in any page
- Just needs `<div id="content"></div>`

### src/sw.js
- Updated service worker with cache-first strategy
- Caches static assets and module files
- Handles external image URLs
- Version: v2

## Usage Workflow

1. **Development**
   ```bash
   # Edit files in src/
   npm run dev
   # View at http://localhost:8080/src/demo.html
   ```

2. **Build for Distribution**
   ```bash
   npm run build
   # Files copied to dist/
   ```

3. **Test Distribution**
   ```bash
   npm run serve
   # View at http://localhost:8080/demo.html
   ```

4. **Deploy**
   - Upload `dist/` folder contents to web server
   - Users include drivesafe.css and drivesafe.js in their pages
   - JSZip loaded from CDN

## Integration Example

```html
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="drivesafe.css">
</head>
<body>
  <div id="content"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="drivesafe.js" data-service-worker="sw.js"></script>
</body>
</html>
```

## External Resources

All resources now loaded from roadsafety.nt.gov.au:

- **ZIP files**: `https://roadsafety.nt.gov.au/_media/elearning/*.zip`
- **Images**: `https://roadsafety.nt.gov.au/_media/elearning/images/*.png`

## Next Steps

1. Test the distribution build: `npm run serve`
2. Verify all modules load correctly
3. Check service worker caching
4. Deploy dist/ folder to production
